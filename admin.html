<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BhA-AI CMS Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  background: linear-gradient(135deg,#020617,#0f172a,#020617);
  color:white;
  font-family:'Segoe UI',sans-serif;
  padding:20px;
}
.box{
  max-width:750px;
  margin:auto;
  backdrop-filter: blur(18px);
  background: rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.1);
  padding:25px;
  border-radius:18px;
}
input,select{
  width:100%;
  padding:12px;
  margin-top:12px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.08);
  background:rgba(255,255,255,0.05);
  color:white;
}
select option{color:black}
button{
  padding:10px 16px;
  margin-top:12px;
  border-radius:12px;
  border:none;
  font-weight:600;
  cursor:pointer;
  background: linear-gradient(135deg,#22c55e,#16a34a);
}
.delete{background:linear-gradient(135deg,#ef4444,#b91c1c)}
.edit{background:linear-gradient(135deg,#38bdf8,#0284c7)}
.section{
  margin-top:35px;
  border-top:1px solid rgba(255,255,255,0.1);
  padding-top:25px;
}
.item{
  background: rgba(255,255,255,0.05);
  padding:14px;
  margin-top:12px;
  border-radius:12px;
}
.flexBtns button{margin-right:6px}
.hidden{display:none}
.facultyCard{
  background:rgba(255,255,255,0.04);
  padding:10px;
  border-radius:10px;
  margin-top:8px;
}
</style>
</head>

<body>

<div class="box" id="loginBox">
<h3>üîê Admin Login</h3>
<input id="loginEmail" placeholder="Email">
<input id="loginPass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<div class="box hidden" id="adminPanel">
<h2>ü§ñ BhA-AI CMS Admin Panel</h2>

<!-- MODULE MANAGER -->
<div class="section">
<h3>üì¶ Module Manager</h3>

<input id="moduleName" placeholder="Module Name">

<select id="moduleType">
<option value="">Select Module Type</option>
<option value="simple">Simple (Title + URL)</option>
<option value="faculty">Faculty (Dept ‚Üí Faculty)</option>
</select>

<button id="moduleBtn" onclick="addModule()">Add Module</button>
<div id="moduleList"></div>
</div>

<!-- ITEM MANAGER -->
<div class="section">
<h3>üìù Item Manager</h3>
<select id="activeModule" onchange="loadItems()"></select>

<div id="dynamicForm"></div>
<div id="itemList"></div>
</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>

const firebaseConfig={
apiKey:"AIzaSyCYJY8PoJSoH_xiyrRHATjj-43j0Q9CrRQ",
authDomain:"bha-ai-admin.firebaseapp.com",
projectId:"bha-ai-admin"
};

firebase.initializeApp(firebaseConfig);

const db=firebase.firestore();
const auth=firebase.auth();

/* LOGIN */

function login(){
auth.signInWithEmailAndPassword(
loginEmail.value,
loginPass.value
).catch(err=>alert(err.message));
}

auth.onAuthStateChanged(user=>{
loginBox.style.display=user?"none":"block";
adminPanel.style.display=user?"block":"none";
});

/* ================= MODULES ================= */

function addModule(){

const name=moduleName.value.trim();
const type=moduleType.value;

if(!name || !type){
alert("Enter module name and select type");
return;
}

const key=name.toLowerCase().replace(/\s+/g,"_");

db.collection("modules").add({
name,
key,
type
});

moduleName.value="";
moduleType.value="";
}

db.collection("modules").onSnapshot(snapshot=>{

moduleList.innerHTML="";
activeModule.innerHTML="<option value=''>Select Module</option>";

snapshot.forEach(doc=>{

const m=doc.data();

moduleList.innerHTML+=`
<div class="item">
<b>${m.name}</b> (${m.type})
<div class="flexBtns">
<button class="edit"
onclick="editModule('${doc.id}','${m.name}','${m.type}')">
Edit
</button>

<button class="delete"
onclick="del('modules','${doc.id}')">
Delete
</button>
</div>
</div>`;

activeModule.innerHTML+=`
<option value="${m.key}" data-type="${m.type}">
${m.name}
</option>`;

});
});

function editModule(id,name,type){

moduleName.value=name;
moduleType.value=type;

moduleBtn.textContent="Update Module";

moduleBtn.onclick=()=>{

db.collection("modules").doc(id).update({
name:moduleName.value,
type:moduleType.value,
key:moduleName.value.toLowerCase().replace(/\s+/g,"_")
}).then(()=>{

moduleBtn.textContent="Add Module";
moduleBtn.onclick=addModule;

moduleName.value="";
moduleType.value="";
});

};
}

/* ================= ITEMS ================= */

function loadItems(){

dynamicForm.innerHTML="";
itemList.innerHTML="";

const opt=activeModule.selectedOptions[0];
if(!opt || !opt.value) return;

const type=opt.dataset.type;

/* SIMPLE MODULE */

if(type==="simple"){

dynamicForm.innerHTML=`
<input id="itemTitle" placeholder="Title">
<input id="itemUrl" placeholder="URL">
<button onclick="addSimpleItem()">Add Item</button>`;

db.collection("items")
.where("module","==",opt.value)
.onSnapshot(s=>{

itemList.innerHTML="";

s.forEach(d=>{

const i=d.data();

itemList.innerHTML+=`
<div class="item">
<b>${i.title}</b><br>${i.url}

<div class="flexBtns">
<button class="edit"
onclick="editSimpleItem('${d.id}','${i.title}','${i.url}')">
Edit
</button>

<button class="delete"
onclick="del('items','${d.id}')">
Delete
</button>
</div>
</div>`;
});
});
}

/* FACULTY MODULE */

if(type==="faculty"){

dynamicForm.innerHTML=`
<input id="deptName" placeholder="Department Name">
<button onclick="addDepartment()">Add Department</button>

<select id="deptDropdown" onchange="showFaculty()">
<option value="">Select Department</option>
</select>

<div id="deptActions"></div>
<div id="facultyBox"></div>`;

loadDepartments();
}
}

/* SIMPLE ITEMS */

function addSimpleItem(){

db.collection("items").add({
module:activeModule.value,
title:itemTitle.value,
url:itemUrl.value
});

itemTitle.value="";
itemUrl.value="";
}

function editSimpleItem(id,title,url){

const t=prompt("Edit title:",title);
const u=prompt("Edit URL:",url);

if(!t || !u) return;

db.collection("items").doc(id).update({
title:t,
url:u
});
}

/* ================= FACULTY ================= */

function addDepartment(){

if(!deptName.value) return alert("Enter department");

db.collection("faculty_departments").add({
name:deptName.value
});

deptName.value="";
}

function loadDepartments(){

db.collection("faculty_departments")
.onSnapshot(s=>{

deptDropdown.innerHTML='<option value="">Select Department</option>';

s.forEach(d=>{
deptDropdown.innerHTML+=`
<option value="${d.id}">
${d.data().name}
</option>`;
});
});
}

function showFaculty(){

const dept=deptDropdown.value;
if(!dept) return;

/* dept buttons */

db.collection("faculty_departments")
.doc(dept)
.get()
.then(doc=>{

deptActions.innerHTML=`
<button class="edit"
onclick="editDepartment('${dept}','${doc.data().name}')">
Edit Dept
</button>

<button class="delete"
onclick="deleteDepartment('${dept}')">
Delete Dept
</button>`;
});

/* faculty UI */

facultyBox.innerHTML=`
<input id="fn" placeholder="Faculty Name">
<input id="fu" placeholder="Faculty URL">
<button onclick="addFaculty('${dept}')">
Add Faculty
</button>

<div id="facultyList"></div>`;

db.collection("faculty_members")
.where("department","==",dept)
.onSnapshot(s=>{

facultyList.innerHTML="";

s.forEach(d=>{

const f=d.data();

facultyList.innerHTML+=`
<div class="facultyCard">

${f.name}

<div class="flexBtns">
<button class="edit"
onclick="editFaculty('${d.id}','${f.name}','${f.url}')">
Edit
</button>

<button class="delete"
onclick="del('faculty_members','${d.id}')">
Delete
</button>
</div>

</div>`;
});
});
}

function editDepartment(id,name){

const n=prompt("Edit Department:",name);
if(!n) return;

db.collection("faculty_departments")
.doc(id)
.update({name:n});
}

function deleteDepartment(id){

if(!confirm("Delete department and all faculty?"))
return;

db.collection("faculty_members")
.where("department","==",id)
.get()
.then(s=>s.forEach(doc=>doc.ref.delete()));

db.collection("faculty_departments")
.doc(id)
.delete();
}

function addFaculty(dept){

if(!fn.value || !fu.value)
return alert("Enter faculty name & URL");

db.collection("faculty_members").add({
department:dept,
name:fn.value,
url:fu.value
});

fn.value="";
fu.value="";
}

/* GLOBAL DELETE */

function del(col,id){
db.collection(col).doc(id).delete();
}

</script>
</body>
</html>
