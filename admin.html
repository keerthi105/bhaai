<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BhA-AI CMS Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  background:#0f172a;
  color:white;
  font-family:Arial;
  padding:20px;
}
.box{
  max-width:650px;
  margin:auto;
  background:#1e293b;
  padding:20px;
  border-radius:12px;
}
h2,h3{text-align:center}
input,select,button{
  width:100%;
  padding:10px;
  margin-top:10px;
  border-radius:6px;
  border:none;
}
button{
  background:#22c55e;
  font-weight:bold;
  cursor:pointer;
}
.section{
  margin-top:30px;
  border-top:1px solid #334155;
  padding-top:20px;
}
.item{
  background:#334155;
  padding:10px;
  margin-top:10px;
  border-radius:6px;
}
.delete{
  background:#ef4444;
  margin-top:6px;
}
.hidden{display:none}
.item a {
  color: #38bdf8; /* uniform color for all links */
  text-decoration: none;
  word-break: break-all;
}

.item a:hover {
  text-decoration: underline;
}

</style>
</head>

<body>
    <div class="box" id="loginBox">
  <h3>üîê Admin Login</h3>
  <input id="loginEmail" placeholder="Email">
  <input id="loginPass" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<div class="box hidden" id="adminPanel">
<h2>ü§ñ BhA-AI CMS Admin Panel</h2>

<!-- MODULE MANAGER -->
<div class="section">
<h3>üì¶ Module Manager</h3>
<input id="moduleName" placeholder="Module Name (Eg: About College)">
<select id="moduleType">
  <option value="simple">Simple (Title + URL)</option>
  <option value="faculty">Faculty (Department-based)</option>
</select>
<button onclick="addModule()">Add Module</button>
<div id="moduleList"></div>
</div>

<!-- ITEM MANAGER -->
<div class="section">
<h3>üìù Item Manager</h3>
<select id="activeModule" onchange="loadItems()"></select>

<div id="simpleForm" class="hidden">
  <input id="itemTitle" placeholder="Title">
  <input id="itemUrl" placeholder="URL">
  <button onclick="addItem()">Add Item</button>
</div>

<div id="facultyForm" class="hidden">
  <input id="deptName" placeholder="Department Name">
  <button onclick="addDepartment()">Add Department</button>
  <div id="deptList"></div>
</div>

<div id="itemList"></div>
</div>
</div>

<!-- Firebase -->
 
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
const firebaseConfig={
  apiKey:"AIzaSyCYJY8PoJSoH_xiyrRHATjj-43j0Q9CrRQ",
  authDomain:"bha-ai-admin.firebaseapp.com",
  projectId:"bha-ai-admin"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

const auth = firebase.auth();

function login() {
  const email = document.getElementById("loginEmail").value;
  const pass = document.getElementById("loginPass").value;

  auth.signInWithEmailAndPassword(email, pass)
    .catch(err => alert(err.message));
}

auth.onAuthStateChanged(user => {
  if (user) {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("adminPanel").style.display = "block";
  } else {
    document.getElementById("loginBox").style.display = "block";
    document.getElementById("adminPanel").style.display = "none";
  }
});


/* SIMPLE MODULES */
function addModule(){
  const name=moduleName.value.trim();
  const type=moduleType.value;
  if(!name)return alert("Enter module name");
  const key=name.toLowerCase().replace(/\s+/g,"_");
  db.collection("modules").add({name,key,type});
  moduleName.value="";
}
db.collection("modules").onSnapshot(s=>{
  moduleList.innerHTML="";
  activeModule.innerHTML="<option value=''>Select Module</option>";
  s.forEach(d=>{
    const m=d.data();
   moduleList.innerHTML += `
  <div class="item">
    <b>${m.name}</b> (${m.type})
    <button class="delete" onclick="editModule('${d.id}','${m.name}','${m.type}')">Edit</button>
    <button class="delete" onclick="del('modules','${d.id}')">Delete</button>
  </div>
`;

    activeModule.innerHTML+=`<option value="${m.key}" data-type="${m.type}">${m.name}</option>`;
  });
});
function editModule(id, name, type) {
  // Pre-fill inputs
  moduleName.value = name;
  moduleType.value = type;

  // Change Add button to Update button temporarily
  const btn = document.querySelector("#moduleList").previousElementSibling; // the Add Module button
  btn.textContent = "Update Module";
  btn.onclick = () => {
    db.collection("modules").doc(id).update({
      name: moduleName.value,
      type: moduleType.value,
      key: moduleName.value.toLowerCase().replace(/\s+/g,"_")
    }).then(() => {
      moduleName.value = "";
      moduleType.value = "simple";
      btn.textContent = "Add Module";
      btn.onclick = addModule;
    });
  };
}

/* ITEM MANAGER */
function loadItems(){
  itemList.innerHTML="";
  deptList.innerHTML="";
  simpleForm.classList.add("hidden");
  facultyForm.classList.add("hidden");

  const opt=activeModule.selectedOptions[0];
  if(!opt)return;
  const type=opt.dataset.type;

  if(type==="simple"){
    simpleForm.classList.remove("hidden");
    db.collection("items").where("module","==",opt.value)
      .onSnapshot(s=>{
        itemList.innerHTML="";
        s.forEach(d=>{
          const i=d.data();
          itemList.innerHTML+=`
<div class="item">
  <b>${i.title}</b><br>
  <a href="${i.url}" target="_blank">${i.url}</a>
  <button class="delete" onclick="editItem('${d.id}','${i.title}','${i.url}')">Edit</button>
  <button class="delete" onclick="del('items','${d.id}')">Delete</button>
</div>`;

        });
      });
  }

  if(type==="faculty"){
    facultyForm.classList.remove("hidden");
    loadDepartments();
  }
}

function addItem(){
  db.collection("items").add({
    module:activeModule.value,
    title:itemTitle.value,
    url:itemUrl.value
  });
  itemTitle.value="";
  itemUrl.value="";
}
function editItem(id, title, url) {
  // Pre-fill inputs
  itemTitle.value = title;
  itemUrl.value = url;

  // Change Add button to Save button temporarily
  const btn = document.querySelector("#simpleForm button");
  btn.textContent = "Update Item";
  btn.onclick = () => {
    db.collection("items").doc(id).update({
      title: itemTitle.value,
      url: itemUrl.value
    }).then(() => {
      itemTitle.value = "";
      itemUrl.value = "";
      btn.textContent = "Add Item";
      btn.onclick = addItem;
    });
  };
}

/* FACULTY */
function addDepartment(){
  const name = deptName.value.trim();
  if(!name) return alert("Enter department name");
  db.collection("faculty_departments").add({ name });
  deptName.value = "";
}

function loadDepartments(){
  db.collection("faculty_departments").onSnapshot(s=>{
    deptList.innerHTML="";
    s.forEach(d=>{
      const deptData = d.data();
      deptList.innerHTML+=`
      <div class="item" id="deptDiv_${d.id}">
        <b id="deptNameText_${d.id}">${deptData.name}</b>
        <input placeholder="Faculty Name" id="fn_${d.id}">
        <input placeholder="Faculty URL" id="fu_${d.id}">
        <button onclick="addFaculty('${d.id}')">Add Faculty</button>
        <button onclick="editDepartment('${d.id}')">Edit Dept</button>
        <button onclick="deleteDepartment('${d.id}')">Delete Dept</button>
        <div id="fl_${d.id}"></div>
      </div>`;
      loadFaculty(d.id);
    });
  });
}

// EDIT DEPARTMENT
function editDepartment(id){
  const nameText = document.getElementById("deptNameText_" + id);
  const currentName = nameText.textContent;

  const newName = prompt("Edit Department Name:", currentName);
  if(newName && newName.trim() !== ""){
    db.collection("faculty_departments").doc(id).update({
      name: newName.trim()
    });
  }
}

// DELETE DEPARTMENT
function deleteDepartment(id){
  if(confirm("Are you sure you want to delete this department? All its faculty will also be removed.")){
    // Delete all faculty under this department
    db.collection("faculty_members").where("department","==",id)
      .get()
      .then(snapshot=>{
        snapshot.forEach(doc => doc.ref.delete());
      });
    // Delete department itself
    db.collection("faculty_departments").doc(id).delete();
  }
}
function addFaculty(dept){
  db.collection("faculty_members").add({
    department:dept,
    name:document.getElementById("fn_"+dept).value,
    url:document.getElementById("fu_"+dept).value
  });
}

function loadFaculty(dept){
  db.collection("faculty_members")
    .where("department","==",dept)
    .onSnapshot(s=>{
      const div=document.getElementById("fl_"+dept);
      div.innerHTML="";
      s.forEach(d=>{
        const f=d.data();
        div.innerHTML+=`
<div>
  <a href="${f.url}" target="_blank">${f.name}</a>
  <button class="delete" onclick="editFaculty('${d.id}','${f.name}','${f.url}')">Edit</button>
  <button class="delete" onclick="del('faculty_members','${d.id}')">X</button>
</div>`;

      });
    });
}
function editFaculty(id, name, url) {
  // Pre-fill the faculty inputs dynamically
  const inputName = document.getElementById("fn_" + id);
  const inputUrl = document.getElementById("fu_" + id);

  inputName.value = name;
  inputUrl.value = url;

  // Change Add button to Update button
  const btn = inputName.nextElementSibling.nextElementSibling; // the Add button
  btn.textContent = "Update";
  btn.onclick = () => {
    db.collection("faculty_members").doc(id).update({
      name: inputName.value,
      url: inputUrl.value
    }).then(() => {
      btn.textContent = "Add Faculty";
      btn.onclick = () => addFaculty(inputName.id.split("_")[1]);
      inputName.value = "";
      inputUrl.value = "";
    });
  };
}

/* DELETE */
/* DELETE */
function del(col,id){
  db.collection(col).doc(id).delete();
}



</script>
</body>
</html>
